import asyncio

from pyrogram import filters
from pyrogram.enums import ChatMembersFilter
from pyrogram.errors import FloodWait
from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup
import random
from InflexMusic import app
from InflexMusic.utils.database import get_served_chats

quotes = [
    "á´á´œsÉªá´„ Éªs á´›Êœá´‡ sá´á´œÉ´á´…á´›Ê€á´€á´„á´‹ á´Ò“ Êá´á´œÊ€ ÊŸÉªÒ“á´‡. ðŸŽ§",
    "á´¡Êœá´‡Ê€á´‡ á´¡á´Ê€á´…s Ò“á´€ÉªÊŸ, á´á´œsÉªá´„ sá´˜á´‡á´€á´‹s. ðŸŽ¶",
    "á´á´œsÉªá´„ Éªs á´›Êœá´‡ á´˜á´á´‡á´›Ê€Ê á´Ò“ á´›Êœá´‡ á´€ÉªÊ€. ðŸŽ¤",
    "ÊŸá´‡á´› á´›Êœá´‡ á´á´œsÉªá´„ Ê™á´‡ Êá´á´œÊ€ É¢á´œÉªá´…á´‡. ðŸŒŒ",
    "ÊŸá´á´ á´‡ Éªs á´›Êœá´‡ á´á´œsÉªá´„ á´Ò“ á´›Êœá´‡ Êœá´‡á´€Ê€á´›. ðŸ’–",
    "á´‡á´ á´‡Ê€Ê ÊŸá´á´ á´‡ sá´É´É¢ Éªs á´€ sá´›á´Ê€Ê á´¡á´€Éªá´›ÉªÉ´É¢ á´›á´ Ê™á´‡ á´›á´ÊŸá´…. ðŸ“–",
    "á´á´œsÉªá´„ Ê™Ê€ÉªÉ´É¢s á´œs á´›á´É¢á´‡á´›Êœá´‡Ê€ ÉªÉ´ á´€ á´¡á´€Ê á´›Êœá´€á´› É´á´á´›ÊœÉªÉ´É¢ á´‡ÊŸsá´‡ á´„á´€É´. ðŸ¤",
    "ÊŸá´á´ á´‡ á´‹É´á´á´¡s É´á´ Ê™á´á´œÉ´á´…s á´¡Êœá´‡É´ Éªá´› á´„á´á´á´‡s á´›á´ á´á´œsÉªá´„. â¤ï¸",
    "á´›Êœá´‡ Ê™á´‡sá´› á´˜á´€Ê€á´› á´Ò“ á´á´œsÉªá´„ Éªs á´›Êœá´€á´› Éªá´› á´‹É´á´á´¡s É´á´ ÊŸá´€É´É¢á´œá´€É¢á´‡. ðŸŒ",
    "á´…á´€É´á´„á´‡ á´›á´ á´›Êœá´‡ Ê€ÊœÊá´›Êœá´ á´Ò“ Êá´á´œÊ€ Êœá´‡á´€Ê€á´›. ðŸ’ƒ",
    "ÊŸá´‡á´› á´›Êœá´‡ á´á´œsÉªá´„ Ò“ÉªÊŸÊŸ Êá´á´œÊ€ sá´á´œÊŸ á´¡Éªá´›Êœ ÊŸá´á´ á´‡. ðŸ•Šï¸",
    "á´á´œsÉªá´„ Éªs á´›Êœá´‡ Ê™Ê€Éªá´…É¢á´‡ Ê™á´‡á´›á´¡á´‡á´‡É´ á´›Êœá´‡ Êœá´‡á´€Ê€á´› á´€É´á´… á´›Êœá´‡ á´ÉªÉ´á´…. ðŸ§ ",
    "á´‡á´ á´‡Ê€Ê É´á´á´›á´‡ á´„á´€Ê€Ê€Éªá´‡s á´€ á´˜Éªá´‡á´„á´‡ á´Ò“ á´Ê Êœá´‡á´€Ê€á´›. ðŸ’ž",
    "á´¡Êœá´‡É´ ÉªÉ´ á´…á´á´œÊ™á´›, á´›á´œÊ€É´ á´œá´˜ á´›Êœá´‡ á´á´œsÉªá´„. ðŸ”Š",
    "ÊŸá´á´ á´‡ Éªs ÊŸÉªá´‹á´‡ á´€ sá´É´É¢; Éªá´› É´á´‡á´ á´‡Ê€ Ò“á´€á´…á´‡s á´€á´¡á´€Ê. ðŸŽµ",
    "ÊŸá´‡á´› Êá´á´œÊ€ Êœá´‡á´€Ê€á´› sÉªÉ´É¢, á´€É´á´… á´›Êœá´‡ á´¡á´Ê€ÊŸá´… á´¡ÉªÊŸÊŸ ÊŸÉªsá´›á´‡É´. ðŸŒ ",
    "á´á´œsÉªá´„ Éªs á´›Êœá´‡ Êœá´‡á´€Ê€á´›Ê™á´‡á´€á´› á´Ò“ ÊŸá´á´ á´‡. ðŸ’“",
    "á´‡á´ á´‡Ê€Ê á´á´‡ÊŸá´á´…Ê á´›á´‡ÊŸÊŸs á´€ ÊŸá´á´ á´‡ sá´›á´Ê€Ê. âœ¨",
    "á´á´œsÉªá´„ Éªs á´›Êœá´‡ á´œÉ´Éªá´ á´‡Ê€sá´€ÊŸ ÊŸá´€É´É¢á´œá´€É¢á´‡ á´Ò“ ÊŸá´á´ á´‡. â¤ï¸",
    "ÊŸá´‡á´› á´›Êœá´‡ Ê€ÊœÊá´›Êœá´ á´Ò“ ÊŸá´á´ á´‡ á´á´á´ á´‡ Êá´á´œ. ðŸ’ƒ",
    "sÉªÉ´É¢ Êá´á´œÊ€ Êœá´‡á´€Ê€á´› á´á´œá´›; á´›Êœá´‡ á´¡á´Ê€ÊŸá´… É´á´‡á´‡á´…s á´›á´ Êœá´‡á´€Ê€ Êá´á´œÊ€ ÊŸá´á´ á´‡. ðŸŽ¶",
    "á´á´œsÉªá´„ á´„á´€É´ Êœá´‡á´€ÊŸ á´›Êœá´‡ á´¡á´á´œÉ´á´…s á´›Êœá´€á´› ÊŸá´á´ á´‡ ÊŸá´‡á´€á´ á´‡s Ê™á´‡ÊœÉªÉ´á´…. ðŸ’”",
    "ÊŸá´‡á´› ÊŸá´á´ á´‡ Ê™á´‡ Êá´á´œÊ€ á´˜ÊŸá´€ÊÊŸÉªsá´›. ðŸŽ¼",
    "á´‡á´ á´‡Ê€Ê ÊŸá´á´ á´‡ sá´É´É¢ Êœá´ÊŸá´…s á´€ á´á´‡á´á´Ê€Ê. ðŸ“…",
    "á´¡Êœá´‡É´ Êá´á´œ ÊŸá´á´ á´‡ sá´á´á´‡á´É´á´‡, á´›Êœá´‡ÉªÊ€ sá´É´É¢ Éªs á´€ÊŸá´¡á´€Ês á´˜ÊŸá´€ÊÉªÉ´É¢ ÉªÉ´ Êá´á´œÊ€ Êœá´‡á´€Ê€á´›. ðŸŽ¼",
    "á´á´œsÉªá´„ Éªs á´›Êœá´‡ ÊŸÉªÉ¢Êœá´› á´›Êœá´€á´› É¢á´œÉªá´…á´‡s á´œs á´›ÊœÊ€á´á´œÉ¢Êœ ÊŸá´á´ á´‡'s á´Šá´á´œÊ€É´á´‡Ê. ðŸŒ ",
    "ÊŸá´á´ á´‡ Éªs á´€ á´á´‡ÊŸá´á´…Ê á´›Êœá´€á´› ÊŸÉªÉ´É¢á´‡Ê€s ÉªÉ´ á´›Êœá´‡ Êœá´‡á´€Ê€á´›. ðŸŽ»",
    "á´…á´€É´á´„á´‡ ÊŸÉªá´‹á´‡ É´á´Ê™á´á´…Ê's á´¡á´€á´›á´„ÊœÉªÉ´É¢, ÊŸá´á´ á´‡ ÊŸÉªá´‹á´‡ Êá´á´œ'á´ á´‡ É´á´‡á´ á´‡Ê€ Ê™á´‡á´‡É´ Êœá´œÊ€á´›. ðŸ’ƒ",
    "á´›Êœá´‡ á´á´€É¢Éªá´„ á´Ò“ á´á´œsÉªá´„ Éªs á´›Êœá´€á´› Éªá´› á´á´€á´‹á´‡s Êá´á´œ Ò“á´‡á´‡ÊŸ á´€ÊŸÉªá´ á´‡. ðŸŒˆ",
    "á´‡á´€á´„Êœ sá´É´É¢ Éªs á´€ á´„Êœá´€á´˜á´›á´‡Ê€ ÉªÉ´ á´›Êœá´‡ sá´›á´Ê€Ê á´Ò“ ÊŸá´á´ á´‡. ðŸ“–",
    "á´á´œsÉªá´„ á´„á´€É´ á´‡xá´˜Ê€á´‡ss á´¡Êœá´€á´› á´¡á´Ê€á´…s á´„á´€É´É´á´á´› sá´€Ê. ðŸ’¬",
    "ÊŸá´‡á´› Êá´á´œÊ€ Êœá´‡á´€Ê€á´› sÉªÉ´É¢ á´›Êœá´‡ ÊŸá´á´ á´‡ Êá´á´œ Ò“á´‡á´‡ÊŸ. ðŸŽ¶",
    "á´‡á´ á´‡Ê€Ê á´„Êœá´Ê€á´… sá´›Ê€á´œá´á´á´‡á´… Éªs á´€ Êœá´‡á´€Ê€á´›Ê™á´‡á´€á´› Ò“á´‡ÊŸá´›. ðŸ’“",
    "Ò“ÉªÉ´á´… á´›Êœá´‡ ÊŸá´á´ á´‡ ÉªÉ´ á´‡á´ á´‡Ê€Ê É´á´á´›á´‡. ðŸŽ¶",
    "ÊŸá´‡á´› á´›Êœá´‡ á´á´œsÉªá´„ á´Ò“ Êá´á´œÊ€ sá´á´œÊŸ sÊœÉªÉ´á´‡ á´›ÊœÊ€á´á´œÉ¢Êœ. ðŸŒŸ",
    "ÊŸá´á´ á´‡ Éªs á´›Êœá´‡ É¢Ê€á´‡á´€á´›á´‡sá´› Ê€ÊœÊá´›Êœá´ á´Ò“ á´€ÊŸÊŸ. ðŸ’ž",
    "Êá´á´œÊ€ Êœá´‡á´€Ê€á´› Éªs á´€ á´„á´€É´á´ á´€s; ÊŸá´‡á´› á´á´œsÉªá´„ á´˜á´€ÉªÉ´á´› Éªá´› á´¡Éªá´›Êœ ÊŸá´á´ á´‡. ðŸŽ¨",
    "ÊŸÉªsá´›á´‡É´ á´›á´ á´›Êœá´‡ á´á´œsÉªá´„ á´Ò“ Êá´á´œÊ€ Êœá´‡á´€Ê€á´›. ðŸŽ§",
    "ÊŸá´á´ á´‡ Éªs á´›Êœá´‡ Êœá´€Ê€á´á´É´Ê á´›Êœá´€á´› á´á´€á´‹á´‡s ÊŸÉªÒ“á´‡ Ê™á´‡á´€á´œá´›ÉªÒ“á´œÊŸ. ðŸŽ¶",
    "sÉªÉ´É¢ á´›Êœá´‡ sá´É´É¢ á´Ò“ Êá´á´œÊ€ Êœá´‡á´€Ê€á´› á´¡Éªá´›Êœ á´Šá´Ê. ðŸ˜Š",
    "á´‡á´ á´‡Ê€Ê sá´É´É¢ Éªs á´€ ÊŸá´á´ á´‡ ÊŸá´‡á´›á´›á´‡Ê€ á´¡á´€Éªá´›ÉªÉ´É¢ á´›á´ Ê™á´‡ á´á´˜á´‡É´á´‡á´…. ðŸ’Œ",
    "ÊŸá´‡á´› á´›Êœá´‡ á´á´œsÉªá´„ á´„á´€Ê€Ê€Ê Êá´á´œ á´›á´ á´˜ÊŸá´€á´„á´‡s á´Ò“ ÊŸá´á´ á´‡. ðŸ’—",
    "ÊŸá´á´ á´‡ Éªs á´›Êœá´‡ sá´¡á´‡á´‡á´›á´‡sá´› á´á´‡ÊŸá´á´…Ê. ðŸŽ¶",
    "sá´œÊ€Ê€á´á´œÉ´á´… Êá´á´œÊ€sá´‡ÊŸÒ“ á´¡Éªá´›Êœ á´›Êœá´‡ á´á´œsÉªá´„ á´Ò“ ÊŸá´á´ á´‡. â¤ï¸",
    "ÊŸá´‡á´› á´‡á´ á´‡Ê€Ê É´á´á´›á´‡ Ê™á´‡ á´€ Ê€á´‡á´ÉªÉ´á´…á´‡Ê€ á´Ò“ ÊŸá´á´ á´‡'s Ê™á´‡á´€á´œá´›Ê. âœ¨",
    "ÊŸá´á´ á´‡ Éªs ÊŸÉªá´‹á´‡ á´€ sá´É´É¢ á´›Êœá´€á´› É´á´‡á´ á´‡Ê€ á´‡É´á´…s. ðŸ’ž",
    "á´›Êœá´‡ Ê€ÊœÊá´›Êœá´ á´Ò“ ÊŸá´á´ á´‡ Éªs Ò“á´‡ÊŸá´› ÉªÉ´ á´‡á´ á´‡Ê€Ê Êœá´‡á´€Ê€á´›Ê™á´‡á´€á´›. â¤ï¸",
]


IS_BROADCASTING = False

async def auto_broadcast():
    global IS_BROADCASTING
    IS_BROADCASTING = True

    keyboard = InlineKeyboardMarkup(
        [[InlineKeyboardButton("Click Me", url="https://example.com")]]
    )

    while True:
        sent = 0
        schats = await get_served_chats()
        
        for chat in schats:
            # Select a random quote from the quotes list
            message_text = random.choice(quotes)
            
            try:
                await app.send_message(chat["chat_id"], text=message_text, reply_markup=keyboard)
                sent += 1
                await asyncio.sleep(0.2)
            except FloodWait as fw:
                flood_time = int(fw.value)
                if flood_time > 200:
                    continue
                await asyncio.sleep(flood_time)
            except:
                continue
        
        try:
            print(f"Broadcast sent to {sent} chats.")
        except:
            pass

        # Wait for 5 minutes before the next broadcast
        await asyncio.sleep(120)  # Change to 300 seconds (5 minutes)

# Start the auto-broadcast function
app.add_handler(asyncio.create_task(auto_broadcast()))